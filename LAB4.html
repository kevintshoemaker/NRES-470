<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="NRES 470/670" />


<title>Lab 4: Matrix population models</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NRES 470/670</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="schedule.html">Schedule</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="INTRO.html">Introduction to NRES 470</a>
    </li>
    <li>
      <a href="LECTURE1.html">A whole-systems approach to population ecology</a>
    </li>
    <li>
      <a href="LECTURE2.html">Introduction to population ecology</a>
    </li>
    <li>
      <a href="LECTURE3.html">Thomas Robert Malthus (Limits to growth)</a>
    </li>
    <li>
      <a href="LECTURE4.html">Population Regulation (Logistic growth)</a>
    </li>
    <li>
      <a href="LECTURE5.html">Positive density dependence (Allee effect)</a>
    </li>
    <li>
      <a href="LECTURE6.html">Age-structured populations</a>
    </li>
    <li>
      <a href="LECTURE7.html">Matrix population models</a>
    </li>
    <li>
      <a href="LECTURE8.html">Stochastic population models</a>
    </li>
    <li>
      <a href="LECTURE9.html">Small population paradigm</a>
    </li>
    <li>
      <a href="LECTURE10.html">Individual-based models</a>
    </li>
    <li>
      <a href="LECTURE11.html">Declining population paradigm</a>
    </li>
    <li>
      <a href="LECTURE12.html">Population Viability Analysis</a>
    </li>
    <li>
      <a href="LECTURE13.html">Metapopulations</a>
    </li>
    <li>
      <a href="LECTURE14.html">PVA example: pdogs and ferrets</a>
    </li>
    <li>
      <a href="LECTURE15.html">Parameter estimation</a>
    </li>
    <li>
      <a href="LECTURE16.html">Species interactions: competition</a>
    </li>
    <li>
      <a href="LECTURE17.html">Species interactions: prey-predator</a>
    </li>
    <li>
      <a href="LECTURE18.html">Wrap-up</a>
    </li>
    <li>
      <a href="PVA1_421.html">NRES421: PVA basics</a>
    </li>
    <li>
      <a href="PVA2_421.html">NRES421: grizzly PVA</a>
    </li>
    <li>
      <a href="PVA3_421.html">NRES421: loggerhead PVA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="LAB1.html">Lab 1: exponential growth</a>
    </li>
    <li>
      <a href="LAB2.html">Lab 2: logistic growth</a>
    </li>
    <li>
      <a href="LAB3.html">Lab 3: age-structured population growth</a>
    </li>
    <li>
      <a href="LAB4.html">Lab 4: matrix population models</a>
    </li>
    <li>
      <a href="LAB5.html">Lab 5: stochasticity and uncertainty</a>
    </li>
    <li>
      <a href="LAB6.html">Lab 6: metapopulations</a>
    </li>
    <li>
      <a href="LAB7.html">Lab 7: capture-mark-recapture</a>
    </li>
    <li>
      <a href="FINAL_PROJECTS.html">Final Projects!</a>
    </li>
    <li>
      <a href="EXTRA_CREDIT.html">Extra Credit!</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lab 4: Matrix population models</h1>
<h4 class="author">NRES 470/670</h4>
<h4 class="date">Spring 2023</h4>

</div>


<p>In this lab we will continue to work with age-structured populations:
specifically, we will get familiar with <strong>matrix projection
models</strong>! Remember that while matrix population models may look
complicated, they are just a modified version of the <em>discrete</em>
exponential growth model: <span class="math inline">\(N_{t+1}=\lambda
\cdot N_t\)</span>.</p>
<p>If you want to follow along in R, you can find the R script <a
href="LAB4.R">here</a>. I recommend right-clicking on the link, saving
the script to a designated folder, and loading up the script in
RStudio.</p>
<div id="mathematics-of-matrix-population-models"
class="section level2">
<h2>Mathematics of matrix population models:</h2>
<p>We all remember the discrete population growth equation:</p>
<p><span class="math inline">\(N_{t+1}=\lambda \cdot N_t \qquad
\text{(Eq. 1)}\)</span>,</p>
<p>where <span class="math inline">\(N\)</span> represents abundance (as
always), <span class="math inline">\(t\)</span> is time (often in
years), and <span class="math inline">\(\lambda\)</span> is the
multiplicative growth rate over the time period <span
class="math inline">\(t \rightarrow t+1\)</span></p>
<p>In other words, <span class="math inline">\(\lambda\)</span> is the
number you multiply this years abundance by to compute next year’s
abundance.</p>
<p>The matrix population growth equation looks pretty much the same!</p>
<p><span class="math inline">\(\mathbf{N}_{t+1} = \mathbf{A} \cdot
\mathbf{N}_{t} \qquad \text{(Eq. 2)}\)</span>,</p>
<p>where <span class="math inline">\(\mathbf{N}\)</span> is a
<strong>vector</strong> of abundances (a ‘package’ of numbers
representing abundances for each life stage), and <span
class="math inline">\(\mathbf{A}\)</span> is the <strong>transition
matrix</strong> (a ‘package’ of numbers representing per-capita
transition rates among life stages from one year to the next).</p>
<p>We can be more explicit about this if we re-write the above equation
this way:</p>
<p><span class="math inline">\(\begin{bmatrix}N_1\\ N_2\\N_3
\end{bmatrix}_{t+1}=\begin{bmatrix}F_1 &amp; F_2 &amp; F_3\\ P_{1
\rightarrow 2} &amp; P_{2 \rightarrow 2} &amp; 0\\ 0 &amp; P_{2
\rightarrow 3} &amp; P_{3 \rightarrow 3}\end{bmatrix} \cdot
\begin{bmatrix}N_1\\ N_2\\N_3 \end{bmatrix}_{t} \qquad \text{(Eq.
3)}\)</span></p>
<p>Where <span class="math inline">\(P_{1 \rightarrow 2}\)</span> is the
probability of advancing from Stage 1 to Stage 2 (fraction of Stage 1
individuals that survive and transition to Stage 2), and <span
class="math inline">\(F_2\)</span> is the <strong>fecundity</strong> of
stage 2 (per-capita offspring production by individuals that started the
year in Stage 2).</p>
<div id="the-transition-matrix" class="section level3">
<h3>The Transition Matrix</h3>
<p>The transition matrix must be a <em>square matrix</em> – meaning that
the number of rows is the same as the number of columns. There must be
the same number of rows and columns as there are life stages for the
species you are modeling. If there are 5 life stages, your transition
matrix must have five rows and five columns.</p>
<div id="age-structured-model-leslie-matrix" class="section level4">
<h4>Age structured model (Leslie matrix)</h4>
<p>The term ‘<strong>Leslie Matrix</strong>’ refers to a specific type
of matrix population model where each stage represents one year of life
(this is an <strong>age-structured</strong> model.</p>
<p>In this class, we will assume that the first age class represents
newborns, or age-0 individuals.</p>
<p>In a Leslie matrix, no individuals can ever stay the same age for
more than one year (obviously). So, terms like <span
class="math inline">\(P_{2 \rightarrow 2}\)</span>, or <span
class="math inline">\(P_{3 \rightarrow 3}\)</span> must be set to zero
by definition.</p>
<p>Each age class is associated with only one survival rate, and this
rate involves transitioning to the next age (one year older!). That is,
survival is represented by only one term per age: e.g., <span
class="math inline">\(P_{2 \rightarrow 3}\)</span>, or <span
class="math inline">\(P_{3 \rightarrow 4}\)</span></p>
<p>For a Leslie matrix, the final year of life must have a survival rate
of zero. Why? Because no individual can survive past the final year of
life!</p>
<p>In this class, we will <em>always</em> assume that reproduction
occurs at the very end of each time step.</p>
<p>This means that all <strong>fecundity</strong> terms in our
transition matrices must be computed as the product of survival and
birth rate (i.e., you must survive to the next year before you can
reproduce!)</p>
<p>In a Leslie Matrix, the term <span class="math inline">\(F_0\)</span>
must be computed as the probability of surviving, <span
class="math inline">\(P_{0 \rightarrow 1}\)</span> and the per-capita
birth rate associated with one-year-olds, <span
class="math inline">\(b(1)\)</span>:</p>
<p><span class="math inline">\(F_0=P_{0 \rightarrow 1}\cdot
b(1)\)</span></p>
<p>Similarly,</p>
<p><span class="math inline">\(F_1=P_{1 \rightarrow 2}\cdot
b(2)\)</span><br />
<span class="math inline">\(F_2=P_{2 \rightarrow 3}\cdot
b(3)\)</span><br />
<span class="math inline">\(F_3=P_{3 \rightarrow 4}\cdot
b(4)\)</span></p>
<p>Here’s an example of an age-structured (Leslie) matrix:</p>
<p><span class="math inline">\(\begin{bmatrix}N_0\\ N_1\\N_2\\ N3
\end{bmatrix}_{t+1}=\begin{bmatrix}F_0 &amp; F_1 &amp; F_2 &amp; 0\\
P_{1 \rightarrow 2} &amp; 0 &amp; 0&amp;0\\ 0 &amp; P_{2 \rightarrow 3}
&amp; 0 &amp;0\\ 0 &amp; 0 &amp; P_{2 \rightarrow 3} &amp;0\end{bmatrix}
\cdot \begin{bmatrix}N_0\\ N_1\\N_2\\N3 \end{bmatrix}_{t} \qquad
\text{(Eq. 3)}\)</span></p>
</div>
<div id="stage-structured-model-lefkovitch-matrix"
class="section level4">
<h4>Stage structured model (Lefkovitch matrix)</h4>
<p>When a matrix is used to represent a stage-structured population, it
is often called a ’Lefkovitch” Matrix.</p>
<p>NOTE: <em>survival <em>P</em> in a stage-structured transition matrix
is NOT necessarily the same thing as survival rate</em> (e.g., g(x) from
a life table). What’s the difference? The answer is that survivors from
one age class may end up in more than one class. For example, some
fraction of Stage 2 individuals may survive but remain in Stage 2 next
year (<span class="math inline">\(P_{2 \rightarrow 2}\)</span>). Another
subset of survivors may end up in Stage 3 (<span
class="math inline">\(P_{2 \rightarrow 3}\)</span>). Together, these two
rates (added together) represent the total survival of Stage 2
individuals!</p>
<p>In contrast: in a Leslie matrix, all individuals must either
transition to the next stage or die. Always remember that (just like in
a Leslie matrix) <em>fecundity <em>F</em> in a stage transition matrix
is NOT the same thing as the age-specific per-capita birth rates
<em>b(x)</em></em> from a life table.</p>
<p>Instead, the Fecundity terms in a stage-transition matrix <span
class="math inline">\(F_{S}\)</span> also takes into account the
<em>survival rate</em> to the next time step (e.g., <span
class="math inline">\(P_{S1 \rightarrow S2}\)</span>)!! For an adult of
stage <span class="math inline">\(S\)</span> to contribute to the next
generation, <em>it must first survive to the next time step</em> before
it can reproduce!.</p>
<p><span class="math inline">\(F_S = P_{this \space year \rightarrow
next \space year} \cdot b(next \space year) \qquad \text{(Eq.
4)}\)</span></p>
<p>Computation of fecundity can get fairly complicated, but if you start
to get confused, always return to this basic principle: <em>fecundity is
survival times birth rate</em>.</p>
<p><span class="math inline">\(F_1=P_{1 \rightarrow 1}\cdot b(1) + P_{1
\rightarrow 2}\cdot b(2)\)</span><br />
<span class="math inline">\(F_2=P_{2 \rightarrow 2}\cdot b(2) + P_{2
\rightarrow 3}\cdot b(3)\)</span><br />
<span class="math inline">\(F_3=P_{3 \rightarrow 3}\cdot b(3) + P_{3
\rightarrow 4}\cdot b(4)\)</span></p>
</div>
</div>
<div id="matrix-operations" class="section level3">
<h3>Matrix operations:</h3>
<p>There is a lot we can do with matrix population models. The most
obvious one is <em>projection</em>:</p>
<div id="projection" class="section level4">
<h4>Projection:</h4>
<p>This lab demo contains a bunch of R code (R makes it pretty easy to
run matrix population models!).</p>
<p>If you want to follow along in R, you can find the R script <a
href="LAB4.R">here</a>.</p>
<p>We have already seen the matrix projection equation (Eq. 2, above).
Here is how we can implement this in R:</p>
<pre class="r"><code># Matrix projection in R ---------------------

# Syntax for projecting abundance using a transition matrix (NOTE: this code won&#39;t run until we specify the terms on the right)

# Year1 &lt;- projection_matrix %*% Abundance_year0  # matrix multiplication!</code></pre>
<p>Let’s try it:</p>
<p>First, build a projection matrix:</p>
<pre class="r"><code># First, build a simple projection matrix called TMat

TMat &lt;- matrix(     # 
  c(
    0.4,     1.9,   0,
    0.4,   0,     0,
    0,     0.75,   0
  )
  ,nrow=3,ncol=3,byrow=T
)
TMat    # print to the console to check!</code></pre>
<pre><code>##      [,1] [,2] [,3]
## [1,]  0.4 1.90    0
## [2,]  0.4 0.00    0
## [3,]  0.0 0.75    0</code></pre>
<p><strong>Q</strong>: is this an age-structured (Leslie) or
stage-structured (Lefkovitch) matrix?</p>
<p>Next, let’s build an initial abundance vector:</p>
<pre class="r"><code># Then we specify initial abundances for the three age classes

InitAbund &lt;- c(1000,0,0)    # initial abundance vector
InitAbund    # print to the console to check!</code></pre>
<pre><code>## [1] 1000    0    0</code></pre>
<p>Now we can run our first projection- this time, we will use the
transition matrix to compute the abundance vector for year 1!</p>
<pre class="r"><code># Now we can run the code for real

# project year-1 abundance:

Year1 &lt;- TMat %*% InitAbund  # matrix multiplication in R uses the symbol &#39;%*%&#39;
Year1</code></pre>
<pre><code>##      [,1]
## [1,]  400
## [2,]  400
## [3,]    0</code></pre>
<p>Now we have 300 individuals in stage 2!</p>
<p>Let’s project one more year:</p>
<pre class="r"><code># Project year-2 abundance

Year2 &lt;- TMat %*% Year1  # matrix multiplication!
Year2</code></pre>
<pre><code>##      [,1]
## [1,]  920
## [2,]  160
## [3,]  300</code></pre>
<p>Finally, here is some code to project many years into the future! You
may want to re-use some of this code for the exercises below.</p>
<pre class="r"><code># Multi-year projection code ----------------------------

#  You may want to modify this code for the examples below:


# Set key parameters -----------------------

nYears &lt;- 20                                            # set the number of years to project
TMat &lt;- matrix(     # 
  c(
    0.4,     1.9,   0,
    0.4,   0,     0,
    0,     0.75,   0
  )
  ,nrow=3,ncol=3,byrow=T
)
InitAbund &lt;- c(1000,0,0)                                # initial abundance vector
AgeStructured &lt;- TRUE          # set to TRUE for Leslie matrix and FALSE for Lefkovitch 


# Use a FOR loop for multi-year projection  -------------

   # NOTE: the code below can be re-used without modification:

allYears &lt;- matrix(0,nrow=nrow(TMat),ncol=nYears+1)     # build a storage array for all stages and all years!
allYears[,1] &lt;- InitAbund  # set the year 0 abundance                                    
for(t in 2:(nYears+1)){   # loop through all years
  allYears[,t] &lt;-  TMat %*% allYears[,t-1]
}
plot(1,1,pch=&quot;&quot;,ylim=c(0,max(allYears)),xlim=c(0,nYears+1),xlab=&quot;Years&quot;,ylab=&quot;Abundance&quot;,xaxt=&quot;n&quot;)  # set up blank plot
cols &lt;- rainbow(ncol(TMat))    # set up colors to use
for(s in 1:ncol(TMat)){
  points(allYears[s,],col=cols[s],type=&quot;l&quot;,lwd=2)     # plot out each life stage abundance, one at a time
}
axis(1,at=seq(1,nYears+1),labels = seq(0,nYears))   # label the axis
if(AgeStructured){
  leg &lt;-  paste(&quot;Age&quot;,seq(0,(ncol(TMat))-1))
}else{
  leg &lt;- paste(&quot;Stage&quot;,seq(1,ncol(TMat))) 
}
legend(&quot;topleft&quot;,col=cols,lwd=rep(2,ncol(TMat)),legend=leg,bty=&quot;n&quot;)  # put a legend on the plot</code></pre>
<p><img src="LAB4_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="compute-lambda" class="section level4">
<h4>Compute lambda</h4>
<p>Clearly this is a growing population. But let’s see exactly what
<span class="math inline">\(\lambda\)</span> is!</p>
<p>NOTE: we are using a “package” in R to make these analyses super
easy! So if you don’t already have the “popbio” package, go to the
“Packages” tab in Rstudio (should be at the top of the lower right
panel), click on “Install”, and then type “popbio” in the “Packages”
field in the pop-up window, then click on the “Install” button.</p>
<pre class="r"><code># Use &#39;popbio&#39; package to compute lambda and SSD -----------

# Use the following line of code if you haven&#39;t installed &#39;popbio&#39; yet. Once you&#39;ve installed it, you can delete the line or comment this line out by adding a pound sign before the &quot;i&quot; in &quot;install.packages&quot;

# install.packages(&quot;popbio&quot;)   # uncomment this line to run - you only need to do this once

# Use the &#39;popbio&#39; package to compute lambda (NOTE: you first have to install the popbio package! You only have to install the package once...)

library(popbio)   # load the &#39;popbio&#39; package in R

lambda(TMat)</code></pre>
<pre><code>## [1] 1.094427</code></pre>
<p>Pretty easy!</p>
</div>
<div id="compute-stable-stage-distribution-s.s.d."
class="section level4">
<h4>Compute stable stage distribution (S.S.D.)</h4>
<p>Clearly the population doesn’t reach a stable age distribution until
a few years into our simulation. What exactly is the stable age
distribution here? We can do this in R:</p>
<pre class="r"><code># Use the &#39;popbio&#39; package to compute the stable age distribution!

stable.stage(TMat)</code></pre>
<pre><code>## [1] 0.6188298 0.2261749 0.1549954</code></pre>
<p>Let’s get started with running some matrix-based population
models!</p>
</div>
</div>
</div>
<div id="exercise-1-age-structured-leslie-matrix-projection-models"
class="section level2">
<h2>Exercise 1: age-structured (Leslie) matrix projection models!</h2>
<p>In this exercise, you will have a chance to play around with an
age-structured (Leslie) matrix population model. But first, you are
asked to translate a life table into an age-structured transition
matrix!</p>
<p>Here is the life table: <a href="life_table4.xlsx">Excel
format</a><br />
<a href="life_table4.csv">CSV format</a></p>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
<th align="right">S(x)</th>
<th align="right">b(x)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">1000</td>
<td align="right">0.0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">231</td>
<td align="right">1.1</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">165</td>
<td align="right">3.9</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">45</td>
<td align="right">3.9</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">9</td>
<td align="right">0.8</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">0</td>
<td align="right">0.0</td>
</tr>
</tbody>
</table>
<p>Translate the above <em>life table</em> into an age-structured
(Leslie) transition matrix with five ages: age 0 (newborns), age 1
(yearlings), age 2, age 3, and age 4. You don’t need to include age 5
because no individuals ever make it there!</p>
<p>Keep the following points in mind:</p>
<ul>
<li>Individuals are in the “age 0” stage if they are between the ages of
0 and 1. They transition to the “age 1” stage (<span
class="math inline">\(P_{0 \rightarrow 1}\)</span>) if they survive to
age 1 (thereby entering their second year of life).<br />
</li>
<li>For individuals of the “age 0” class to contribute new offspring to
the population in the next time step (<span
class="math inline">\(F_0\)</span>), they have to survive their first
year of life (<span class="math inline">\(P_{0 \rightarrow 1}\)</span>)
AND produce offspring when they are exactly 1 year of age (which they do
at the rate of <span class="math inline">\(b(1)\)</span> – the birth
rate at age 1).<br />
</li>
<li>Use five age classes for your transition matrix (age class 0 through
4). Individuals in the final age class (age class 4) have zero survival
(you can’t survive to age 5) and zero fecundity (if no 4-year-olds
survive the whole year, how can they reproduce at the end of that
year?)<br />
</li>
<li>No individual ever stays the same age - they either transition to
the next age or they die (this is a <strong>Leslie Matrix</strong>
model).</li>
</ul>
<p>NOTE: Gotelli uses the term ‘age class 1’ to refer to individuals in
their first year of life (0-year-olds) and ‘age class 2’ for individuals
in their second year of life (one-year-olds), but I think it’s easier to
think of this as age 0, age 1, etc. That way, our age classes will match
the way we usually talk about age in years!</p>
<p>1a (image upload). Upload an image file of the full transition matrix
(25 numbers, arranged in 5 rows and 5 columns) to WebCampus. To maximize
your chance for partial credit, include all calculations you needed to
arrive at your final solution.</p>
<p>1b (short answer). Describe (in words) how you computed the number in
row 1, column 3 of your matrix (fecundity of 2-year-olds).</p>
<p>You will need to use R for the next few questions. Make sure you have
the ‘popbio’ package installed in your R session!</p>
<p>You will need to enter your matrix from 1a into R, using something
like the following:</p>
<pre class="r"><code># Construct a five-age matrix:

TMat &lt;- matrix(     # 
  c(
    0.4,     1.9,   1.1,    0.4,   0,  
    0.4,     0,     0,      0,     0,  
    0,       0.75,  0,      0,     0, 
    0,       0,     0.65,   0,     0, 
    0,       0,     0,      0.22,  0 
  )
  ,nrow=5,ncol=5,byrow=T
)
TMat</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]  0.4 1.90 1.10 0.40    0
## [2,]  0.4 0.00 0.00 0.00    0
## [3,]  0.0 0.75 0.00 0.00    0
## [4,]  0.0 0.00 0.65 0.00    0
## [5,]  0.0 0.00 0.00 0.22    0</code></pre>
<p>1c (short answer- one number). What is the finite rate of growth
<span class="math inline">\(\lambda\)</span> for this population?</p>
<p>1d (short answer). Based on this result, is this a growing
population? A declining population? (HINT: use the ‘lambda()’ function
from the popbio package)</p>
<p>1e (short answer- 5 numbers). What is the stable-stage distribution
(SSD) for this population (fraction of the population in each age after
the simulation stabilizes)? (HINT: use the ‘stable.stage()’ function
from the popbio package) (HINT: a complete answer to this question
requires exactly 5 numbers)</p>
<p>1f (short answer- 5 numbers). Assuming an initial population size of
1000 at stable stage distribution (SSD; see answer from 1d), how many
individuals would you have in each of the five ages? (NOTE: you can’t
have fractional individuals, so please round to the nearest whole
numbers).</p>
<p>Next, use R to project this population for 30 years (you can re-use
much of the code supplied above). Initialize your population with 1000
individuals at stable age distribution (your answer from part 1e.</p>
<p>1g. (short answer- one number). What is the total number of
3-year-olds in the population after 30 years?</p>
<p>1h. (short answer- one number). What is the total population
abundance (sum of abundances across all ages) after 30 years?</p>
<p>Finally, run your simulation again, this time starting with all 1000
individuals in age-class 0 (all newborns!) instead of distributing them
across all ages. This time, run your model for 50 years.</p>
<p>1i (image upload). Upload an image (plot) of abundance over time for
all ages. The x-axis should represent time in years (years 0 to 50), and
the y axis should represent abundance. The plot should include 5 lines,
one for each age. (HINT: you can re-use the R code above to produce this
plot).</p>
</div>
<div
id="exercise-2-translate-insightmaker-to-age-structured-projection-matrix"
class="section level2">
<h2>Exercise 2: translate InsightMaker to age-structured projection
matrix!</h2>
<p>Return to the InsightMaker model you created in Lab 3 (exercise 3 –
that is, an age structured population model. Your model should look
something like this:</p>
<p><img src="IM7.jpg" style="width:50.0%" /></p>
<p>Make sure the parameters are at the original values specified in
Exercise 3 of Lab 3 (before altering mortality rates as part of lab 3
question 3e). As a reminder, here they are again:</p>
<ul>
<li>For birth rates, set <em>Birth rate, age 1</em> at 1.6 and <em>Birth
rate, age 2</em> at 2.2.<br />
</li>
<li>For transition rates, set <em>Transition rate, Age 0 to 1</em> at
0.4 and <em>Transition rate, Age 1 to 2</em> at 0.3. NOTE: these
transition rates could also be called “survival rates”<br />
</li>
<li>For the mortality rates, note that all individuals in the <em>Age
0</em> stock must either transition to <em>Age 1</em> or die. In
addition, all individuals in the <em>Age 2</em> stock must die- there is
no <em>Age 3</em> class!</li>
</ul>
<p>Translate this InsightMaker model into a projection matrix with three
rows and three columns. Pay close attention to the difference between
survival (transition to the next stage class) and mortality (mortality
is equal to one minus survival).</p>
<p>2a (image upload). Upload an image file of the full transition matrix
(9 numbers, arranged in 3 rows and 3 columns) to WebCampus. To maximize
your chance for partial credit, include all calculations you needed to
arrive at your final solution.</p>
<p>Starting with 75 individuals, all in Age 0 (75 newborns, 0 yearlings,
0 2-year-olds), project this population 20 years into the future, using
both InsightMaker and R.</p>
<p>2b (image upload). Upload an image (plot) of abundance over time for
all ages, produced using R. The x-axis should represent time in years
(years 0 to 20), and the y axis should represent abundance. The plot
should include 3 lines, one for each age. (HINT: you can re-use the R
code above to produce this plot).</p>
<p>2c (image upload). Upload an image (plot) of abundance over time for
all ages, produced using InsightMaker. The x-axis should represent time
in years (years 0 to 20), and the y axis should represent abundance. The
plot should include 3 lines, one for each age.</p>
<p>HINT: check your answers to 2b and 2c by comparing the two plots:
These plots should look essentially identical!</p>
<p>Now let’s build an InsightMaker model based on a population
matrix!</p>
</div>
<div
id="exercise-3-translate-stage-structured-projection-matrix-to-insightmaker"
class="section level2">
<h2>Exercise 3: translate stage-structured projection matrix to
Insightmaker!</h2>
<div id="use-the-following-stage-matrix-to-answer-questions-3a-b"
class="section level4">
<h4>Use the following stage matrix to answer questions 3a-b</h4>
<p>Here is a stage-based matrix to use for building your InsightMaker
model:</p>
<p>Click <a href="stage_matrix1.csv">here</a> to download the CSV
file.<br />
Click <a href="stage_matrix1.xlsx">here</a> to download the same matrix
as an Excel file.</p>
<pre class="r"><code>stmat &lt;- read.csv(&quot;stage_matrix1.csv&quot;)
stmat &lt;- as.matrix(stmat[,-1])
rownames(stmat) &lt;- colnames(stmat)
stmat</code></pre>
<pre><code>##        Stage1 Stage2 Stage3
## Stage1   0.08   0.40   0.77
## Stage2   0.39   0.14   0.00
## Stage3   0.00   0.49   0.81</code></pre>
<pre class="r"><code># lambda(stmat) </code></pre>
<p>Build an InsightMaker model that represents the same population as
the stage-based matrix above. Remember that the top row represents
fecundity terms, while the bottom rows represent transition terms. Also
remember how to convert between survival rates and mortality rates
(mortality equals one minus survival). Initialize the model with 100
individuals at stable stage distribution (SSD).</p>
<p>3a (short answer). Provide the URL to your InsightMaker model (and
remember to clone your Insight to ensure that you don’t alter the model
once you submit it).</p>
<p>Next, project this population 20 years into the future using both R
AND InsightMaker.</p>
<p>3b (image upload). Upload an image (plot) of abundance over time for
all ages, produced using R. The x-axis should represent time in years
(years 0 to 20), and the y axis should represent abundance. The plot
should include 3 lines, one for each age.</p>
<p>3c (image upload). Upload an image (plot) of abundance over time for
all ages, produced using InsightMaker. The x-axis should represent time
in years (years 0 to 20), and the y axis should represent abundance. The
plot should include 3 lines, one for each age.</p>
<p>HINT: check your answers to 3b and 3c by comparing the two plots:
These plots should look essentially identical!</p>
<p>NOTE: In this class we have stressed the importance of density
dependence in determining and regulating the dynamics of real
populations. Were any of the population models in this lab
density-dependent? [Answer: NO!]</p>
</div>
</div>
<div
id="exercise-4.-translate-written-population-description-to-projection-matrix"
class="section level2">
<h2>Exercise 4. Translate written population description to projection
matrix!</h2>
<p>As a test of your understanding, try to implement the following
passage as a matrix projection model:</p>
<p><img src="redtail1.jpg" style="width:30.0%" /></p>
<blockquote>
<p>We assumed that the red-tailed hawk life history could be described
in terms of three major life stages: hatchling (first year of life),
juvenile (largely individuals in their second year of life), and adult
(generally the third year of life and beyond). We assumed that adult
females experienced an average of 15% mortality each year. Juvenile
female mortality was set at 30% per year. Approximately 10% of juvenile
females remain in the juvenile phase each year, and all other survivors
transition to the adult stage. Finally, hatchlings had a 21% chance of
surviving and transitioning to become juveniles. Adults are the primary
reproductive stage, and produce an average of 6 new hatchlings each
year, half of which are female. Juveniles that fail to transition to the
Adult stage tend to produce only 1.8 new hatchlings each year on
average, half of which are female. We ran a female-only matrix
population model, and we initialized the population with 800 hatchlings,
150 juveniles, and 50 adults.</p>
</blockquote>
<p>4a (image upload). Upload an image file of the full transition matrix
(9 numbers, arranged in 3 rows and 3 columns) to WebCampus. To maximize
your chance for partial credit, include all calculations you needed to
arrive at your final solution.</p>
<p>4b (short answer: three numbers). How many hatchlings, juveniles and
adults would there be in the population at time 0 if you were to
initialize the population at S.A.D.? Use the same initial population
size as the example above (1000 total individuals at time 0).</p>
<p>4c (one number). What is the finite growth rate, Lambda, for this
population?</p>
<p>##Checklist for Lab 4 completion</p>
<ul>
<li><p>Please submit all responses <em>using Top Hat</em>!</p></li>
<li><p>As always, URLs for your InsightMaker models should be pasted in
your lab submission (in Top Hat). See details below…</p></li>
</ul>
<p><strong><em>Due Fri Mar. 10 at 11:59pm</em></strong></p>
<ul>
<li>Word document with short answers
<ul>
<li><strong>Exercise 1</strong>
<ul>
<li><em>image upload (1a.)</em><br />
</li>
<li><em>short answer (1b.)</em><br />
</li>
<li><em>short answer (1c.)</em></li>
<li><em>short answer (1d.)</em></li>
<li><em>short answer (1e.)</em></li>
<li><em>short answer (1f.)</em></li>
<li><em>short answer (1g.)</em></li>
<li><em>short answer (1h.)</em></li>
<li><em>image upload (1i.)</em></li>
</ul></li>
<li><strong>Exercise 2</strong>
<ul>
<li><em>image upload (2a.)</em></li>
<li><em>image upload (2b.)</em></li>
<li><em>image upload (2c.)</em></li>
</ul></li>
<li><strong>Exercise 3</strong>
<ul>
<li><em>short answer (3a.)</em></li>
<li><em>image upload (3b.)</em></li>
<li><em>image upload (3c.)</em></li>
</ul></li>
<li><strong>Exercise 3</strong>
<ul>
<li><em>image upload (4a.)</em></li>
<li><em>short answer (4b.)</em></li>
<li><em>short answer (4c.)</em></li>
</ul></li>
</ul></li>
</ul>
<p>—End of Lab 4—-</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
